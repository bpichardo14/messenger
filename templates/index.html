{% extends 'navbar.html' %}
{% block content %}
<!DOCTYPE html>
<html lang="en">
<head> 
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous"> -->
    <!-- <link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='style.css') }}"> -->
</head> 
	<meta charset="UTF-8">
	<title>Chat</title>
    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.5/socket.io.min.js"></script>
	<script type="text/javascript">
		$(document).ready(function(){

			// 1. sending a connect request to the server.
			socket = io.connect(
                `${location.protocol}//${document.domain}:${location.port}`
            );
            console.log(socket)

            // 5. broadcasts message
            function broadcasted_message(data) {
                console.log(data['message'])
                console.log('Hit broadcasted')
                var li_container = document.createElement('div')
                var img = new Image(); 
                img.src = '../static/images/david.png'
                img.classList.add('img-fluid')
                img.classList.add('message_img')

                var li_message = document.createElement("p")
                li_message.classList.add('message')
                li_message.innerHTML=`${data['username']} ${data['message']}`

                li_container.appendChild(img)
                li_container.appendChild(li_message)

                
                document.querySelector('.body').appendChild(li_container)
            }

            // 4. listens to the new_message channel (reword this)
            socket.on('new_message', broadcasted_message)
            // on --> listening 
            // emit --> calling

        })

        // 2. get input information and send it to the server
        function send_message() {

            var my_message = document.querySelector("#message").value
            console.log("send_message function")
            if (my_message){
                document.querySelector("#message").value = ''
                socket.emit('message', {'message':my_message, 'username': "{{ current_user.username }}"}) // calls whoever is listening on the message channel and sends message
            }
        }

	</script>

</head>
<body>
    <div class="container"> 
        
        <div class="header"> 
            <h1>TuneTalks</h1>
        </div>
        
        <div class="body">

        </div>
         
        <div class="footer">

            <form action="#" onsubmit= "send_message(); return false" >
                <input type="text" id="message"> 
                <button type="submit" > SEND </button>
            </form>
            
        </div>

    </div>
	
</body>
</html>
{% endblock %}




